{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container">
    <h1>Speech Assistant</h1>
    <form id="speech-form">
        <div class="form-group">
            <label for="text-input">Enter Text:</label>
            <textarea 
                id="text-input" 
                name="text" 
                rows="4" 
                required
                aria-label="Text to convert to speech"
                placeholder="Enter your text here..."
            ></textarea>
        </div>
        
        <div class="form-group">
            <label for="voice-select">Select Voice:</label>
            <select id="voice-select" name="voice">
                <option value="amy">Amy</option>
                <option value="arctic">Arctic</option>
                <option value="bryce">Bryce</option>
            </select>
        </div>

        <div class="form-group">
            <label class="checkbox-label">
                <input 
                    type="checkbox" 
                    id="enhance-toggle" 
                    name="enhance" 
                    checked
                >
                Enhance text using LLaMA
            </label>
        </div>

        <button type="submit">Generate Speech</button>
    </form>
    
    <div id="enhanced-text" class="mt-4" style="display: none;">
        <h3>Enhanced Text:</h3>
        <p id="enhanced-text-content"></p>
    </div>
    
    <div id="audio-output" class="mt-4" aria-live="polite"></div>
</div>

<script>
document.getElementById('speech-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const textInput = document.getElementById('text-input').value;
    const voiceSelect = document.getElementById('voice-select').value;
    const enhanceToggle = document.getElementById('enhance-toggle').checked;
    const audioOutput = document.getElementById('audio-output');
    const enhancedTextDiv = document.getElementById('enhanced-text');
    const enhancedTextContent = document.getElementById('enhanced-text-content');
    
    // Show loading state
    audioOutput.innerHTML = '<p>Processing...</p>';
    enhancedTextDiv.style.display = 'none';
    
    try {
        const response = await fetch('/synthesize', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                text: textInput,
                voice: voiceSelect,
                enhance: enhanceToggle
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Show enhanced text if available
            if (enhanceToggle && data.enhanced_text) {
                enhancedTextContent.textContent = data.enhanced_text;
                enhancedTextDiv.style.display = 'block';
            }
            
            // Create and play audio
            const audio = new Audio(`data:audio/wav;base64,${data.audio}`);
            audioOutput.innerHTML = '<p>Playing audio...</p>';
            audio.onended = () => {
                audioOutput.innerHTML = '<p>Audio playback completed</p>';
            };
            audio.play();
        } else {
            audioOutput.innerHTML = `<p class="error">Error: ${data.error}</p>`;
        }
    } catch (error) {
        audioOutput.innerHTML = `<p class="error">Error: ${error.message}</p>`;
    }
});
</script>
{% endblock %}